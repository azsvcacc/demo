# List of IP restrictions by CIDR ranges
variable "ip_cidr_restrictions" {
  description = "List of IP addresses or CIDR ranges to allow access."
  type        = list(string)
  default     = [
    "168.183.0.0/16",
    "149.111.0.0/16",
    "128.35.0.0/16",
    "161.249.0.0/16",
    "198.203.174.0/23",
    "198.203.176.0/22",
    "198.203.180.0/23",
    "40.70.215.155/32"
  ]
}

# List of service tag restrictions
variable "service_tag_restrictions" {
  description = "List of service tag rules with name, priority, action, and service tag."
  type = list(object({
    name        = string
    priority    = number
    action      = string
    service_tag = string
  }))

  default = [
    {
      name        = "FrontdoorRule"
      priority    = 100
      action      = "Allow"
      service_tag = "AzureFrontDoor.Backend"
    }
  ]
}

######################################

  # Apply service tag restrictions
  dynamic "ip_restriction" {
    for_each = var.service_tag_restrictions
    content {
      name        = ip_restriction.value.name
      priority    = ip_restriction.value.priority
      action      = ip_restriction.value.action
      service_tag = ip_restriction.value.service_tag
    }


# List of service tag restrictions
service_tag_restrictions = [
  {
    name        = "FrontdoorRule"
    priority    = 100
    action      = "Allow"
    service_tag = "AzureFrontDoor.Backend"
  }
]
