name: Deploy React Frontend to Free VM

on:
  push:
    branches:
      - main  # Trigger deployment when code is pushed to the main branch

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      # Step 1: Check out the repository code
      - name: Checkout code
        uses: actions/checkout@v3

      # Step 2: Add SSH private key to access VM securely
      - name: Set up SSH key
        uses: webfactory/ssh-agent@v0.5.3
        with:
          ssh-private-key: ${{ secrets.SSH_PRIVATE_KEY }}

      # Step 3: SSH into Free VM and clone the repository using hardcoded values
      - name: SSH into Free VM and clone repo
        run: |
          ssh -o StrictHostKeyChecking=no your_vm_username@your_vm_host_ip << 'EOF'
            # Navigate to the home directory on the VM
            cd /home/your_vm_username
            
            # Clone the GitHub repository using a hardcoded Personal Access Token (PAT)
            git clone https://your_github_username:your_personal_access_token@github.com/LightningNodes/react-frontend.git
            
            # Navigate into the cloned repository directory
            cd react-frontend
            
            # Copy the example .env file to .env
            cp .env.example .env
          EOF

      # Step 4: Install dependencies with Yarn
      - name: Install dependencies on the VM
        run: |
          ssh -o StrictHostKeyChecking=no your_vm_username@your_vm_host_ip << 'EOF'
            cd /home/your_vm_username/react-frontend

            # Install the project dependencies using Yarn
            yarn install
          EOF

      # Step 5: Build the application and start in Production
      - name: Build and start app in Production
        run: |
          ssh -o StrictHostKeyChecking=no your_vm_username@your_vm_host_ip << 'EOF'
            cd /home/your_vm_username/react-frontend

            # Build the application for production
            yarn build

            # Start the application in production
            yarn start  # Ensure this is correct, as 'yarn star' may be a typo
          EOF
