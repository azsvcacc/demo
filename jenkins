pipeline {
    agent none  // No global agent, as we are defining agents per stage
    environment {
        AZURE_SUBSCRIPTION_ID = 'your-azure-subscription-id'
        AZURE_RESOURCE_GROUP = 'your-resource-group-name'
        AZURE_TEMPLATE_FILE = 'logic-app-template.json'
        AZURE_DEPLOYMENT_NAME = 'logicAppDeployment'
    }
    stages {
        stage('Build Stage') {
            agent {
                docker {
                    image 'maven:3.8.4-jdk-11'  // Example build image
                    label 'docker-agent'
                }
            }
            steps {
                echo 'Building the project...'
                // Your build commands go here
            }
        }
        stage('Deploy Logic App') {
            agent {
                docker {
                    image 'mcr.microsoft.com/azure-cli'  // Azure CLI for deployment
                    label 'docker-agent'
                }
            }
            steps {
                script {
                    withCredentials([azureServicePrincipal('azure-credentials-id')]) {
                        sh """
                            az deployment group create \
                            --resource-group $AZURE_RESOURCE_GROUP \
                            --subscription $AZURE_SUBSCRIPTION_ID \
                            --name $AZURE_DEPLOYMENT_NAME \
                            --template-file $AZURE_TEMPLATE_FILE \
                            --parameters logicAppName=myLogicApp
                        """
                    }
                }
            }
        }
    }
    post {
        always {
            echo 'Pipeline completed'
        }
    }
}
